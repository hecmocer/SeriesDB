<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Geolocation</title>
</head>
<body>
    <button id="requestButton">Comenzar geolocalización</button>
    <button id="stopButton">Finalizar geolocalización</button>
    <div id="map" style="width: 100%; height: 300px;"></div>
    <div id="data"></div>

    <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>

    <script>

    var operationID = null; // Almacena el id del watchPosition

    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 18,
        center: new google.maps.LatLng(0, 0)
    });

    $("#requestButton").on("click", function(){
        console.log("coge click");
        // Solicita la posición actual de manera asíncrona
        operationID = navigator.geolocation.watchPosition(
            function(data){ // successHandler
                console.log("Geolocalización conseguida", data);
                var html = "<ul>"
                html += "<li><strong>Latitud: </strong>" + data.coords.latitude + "</li>"
                html += "<li><strong>Longitud: </strong>" + data.coords.longitude + "</li>"
                html += "<li><strong>Precisión: </strong>" + data.coords.accuracy + "</li>"
                $("#data").html(html);
                map.setCenter(new google.maps.LatLng(
                    data.coords.latitude,
                    data.coords.longitude
                    ));
            },
            function(error){ // errorHandler
                console.error("Geolocalización fallida", error);

            },
            { // Opciones de configuración
                enableHighAccuracy: true,
                maximumAge: 0

            }
            );
        console.log("Operation ID", operationID);
    });

$("#stopButton").on("click", function(){
    console.log("Geolocalización finalizada")
    navigator.geolocation.clearWatch(operationID);
})
</script>

</body>
</html>